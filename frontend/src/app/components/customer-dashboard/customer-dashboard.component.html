
    <div class="dashboard-container">
      <!-- Header -->
      <header class="dashboard-header">
        <div class="header-left">
          <h2> Your Car Your Way Customer Dashboard</h2>
          <span class="user-info">Welcome, {{ currentUser?.name }}!</span>
        </div>
        <button (click)="leaveChat()" class="btn btn-leave">
          üè† Leave Chat
        </button>
      </header>

      <div class="dashboard-content">
        <!-- Sidebar -->
        <aside class="sidebar">
          <!-- Start New Conversation Section -->
          <div class="sidebar-section">
            <div class="section-header" (click)="toggleNewConversation()">
              <h3>Start New Conversation</h3>
              <span class="toggle-icon">
                {{ showNewConversation ? '‚ñº' : '‚ñ∂' }}
              </span>
            </div>
            
            @if (showNewConversation) {
              <div class="agents-section">
                <div class="agents-header">
                  <h4>Available Agents</h4>
                  <button (click)="toggleNewConversation()" class="btn btn-cancel">
                    Cancel
                  </button>
                </div>
                
                <div class="agents-list">
                  @for (agent of agents; track agent.id) {
                    <div class="agent-item" (click)="startConversationWithAgent(agent)">
                      <div class="agent-avatar">{{ getInitial(agent.name) || 'A' }}</div>
                      <div class="agent-info">
                        <strong>{{ agent?.user?.name }}</strong>
                        <span class="agent-status">‚óè Online</span>
                        <span class="agent-specialty">Support Agent</span>
                      </div>
                    </div>
                  }
                  @if (agents.length === 0) {
                    <div class="no-agents">No agents available at the moment</div>
                  }
                </div>
              </div>
            } @else {
              <div class="start-conversation-prompt">
                <p>Ready to start a new conversation?</p>
                <button (click)="toggleNewConversation()" class="btn btn-start">
                  Start New Chat
                </button>
              </div>
            }
          </div>

          <!-- My Conversations Section -->
          <div class="sidebar-section">
            <h3>My Conversations</h3>
            <div class="conversations-list">
              @for (conversation of conversations; track conversation.id) {
                <div class="conversation-item" 
                     [class.active]="selectedConversation?.id === conversation.id"
                     (click)="selectConversation(conversation)">
                  <div class="conversation-avatar">
                     {{ getInitial(conversation.agent?.name || 'A') }}
                  </div>
                  <div class="conversation-info">
                    Chat with
                    <strong>  {{ conversation.agent?.name || 'Waiting for agent...' }}</strong>
                    <span class="conversation-time">
                      {{ conversation.createdAt | date:'MMM d' }}
                    </span>
                    <span class="conversation-status" 
                          [class.connected]="conversation.agent"
                          [class.waiting]="!conversation.agent">
                      {{ conversation.agent ? 'Active' : 'Waiting' }}
                    </span>
                  </div>
                </div>
                <!--{{ conversation.agent?.name| json }}-->
              }
              @if (conversations.length === 0) {
                <div class="no-conversations">
                  <p>No conversations yet</p>
                  <small>Start a new chat to begin</small>
                </div>
              }
            </div>
          </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-area">
          @if (selectedConversation) {
            <div class="chat-header">
              <div class="chat-partner-info">
                <div class="partner-avatar">
                  {{ getInitial(selectedConversation.agent?.name || 'A') }}
                </div>
                <div class="partner-details">
                  <h3> {{ selectedConversation.agent?.name || 'Waiting for agent...' }}</h3>
                  <div class="chat-status" [class.connected]="selectedConversation.agent">
                    {{ selectedConversation.agent ? '‚óè Online' : '‚óè Waiting for agent to join...' }}
                  </div>
                </div>
              </div>
            </div>

            <div class="chat-messages" #messageContainer>
              @if (messages.length === 0) {
                <div class="empty-chat">
                  <div class="empty-icon">üí¨</div>
                  <h4>No messages yet</h4>
                  <p>Start the conversation by sending a message</p>
                </div>
              }
              
              @for (message of messages; track message.id) {
                <div [class.my-message]="message.sender.id === currentUser?.id" 
                     [class.agent-message]="message.sender.id !== currentUser?.id"
                     class="message">
                  <div class="message-sender">{{ message.sender.name }}</div>
                  <div class="message-content">{{ message.content }}</div>
                  <div class="message-time">{{ message.createdAt | date:'shortTime' }}</div>
                </div>
              }
            </div>

            <div class="message-input-container">
              <input [(ngModel)]="newMessage" 
                     placeholder="Type your message..." 
                     (keyup.enter)="sendMessage()"
                     [disabled]="!selectedConversation.agent">
              <button (click)="sendMessage()" 
                      [disabled]="!newMessage.trim() || !selectedConversation.agent"
                      class="btn btn-send">
                Send
              </button>
            </div>
          } @else {
            <div class="no-conversation">
              <div class="welcome-message">
                <div class="welcome-icon">üëã</div>
                <h3>Welcome to Customer Support!</h3>
                <p>Select a conversation from the sidebar or start a new chat with an available agent.</p>
                <div class="welcome-features">
                  <div class="feature">
                    <span class="feature-icon">‚ö°</span>
                    <span>Quick responses</span>
                  </div>
                  <div class="feature">
                    <span class="feature-icon">üõ†Ô∏è</span>
                    <span>Expert support</span>
                  </div>
                  <div class="feature">
                    <span class="feature-icon">üí¨</span>
                    <span>Real-time chat</span>
                  </div>
                </div>
              </div>
            </div>
          }
        </main>
      </div>
    </div>